#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION
#include "lib/python_manager.hpp"
#include <pybind11/stl.h>

using namespace std::chrono;
namespace pys = pyscheduler;

int main() {
	pys::PyManager manager;
	pys::PyManager::InvokeHandler encoder = manager.getPythonModule("python_models.encoder");

	std::vector<std::string> queries = { "hello world",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "how old are you?",
										 "what's 3+3",
										 "what's the weather today?",
										 "do you like apples or oranges?" };
	// pybind11::gil_scoped_acquire gil;
	// pybind11::list py_list = pybind11::gil.dec_ref();

	auto empty = [](pybind11::object object) { return 0; };

	// std::queue<pys::PyObjectShared> queue;
	// auto toTensor = [&queue](pys::PyObjectShared obj) {
	// 	queue.push(obj);
	// 	// py::object tensor_obj = py::reinterpret_borrow<py::object>(obj.get());
	// 	// at::Tensor tensor = tensor_obj.cast<at::Tensor>();
	// 	// std::cout << "Shape: " << tensor.sizes() << "\n";
	// 	// std::cout << "Device: " << tensor.device() << "\n";
	// };

	// pys::PyObjectShared args;
	// {
	// 	pys::utils::ScopedPyGIL gil;
	// 	args = pys::utils::asPyArgs(pys::utils::asPyList(queries));
	// }

	for(int i = 0; i < 1024; i++) {
		encoder.queue_invoke(empty, queries);
	}

	return 0;
}
